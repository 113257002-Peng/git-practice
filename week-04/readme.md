# 任務內容

- [x] 建立 EC2 主機與部署 Web Server
- [x] Linux 的基本指令操作練習(存到 linux.md)
- [x] 回答所有問題

---

## 1. public IP: 54.248.207.103

## 2. 什麼是 instance type?

Instance Type（執行個體類型），在我的理解上就是當你在架設雲端伺服器時所使用的硬體配置。你可以自己選擇 CPU、RAM、儲存空間等硬體效能。

## 3. 什麼是 Nginx？有哪些用途與特性？

Nginx 是一個高效能的 Web Server 以及反向代理 Server。

**以下是我的理解:**

- 其實 Nginx 跟 Express 一樣都可以當作 Web Server。所以像是靜態網頁也可以透過 Nginx 進行伺服器的配置與運作。
- 但 Nginx 通常沒辦法直接跟一些動態 Web 進行操作，因為牽扯到資料庫、表單提交等等的動態過程。
- 不過 Nginx 是一個非常高效率的 Web Server 之外，他還可以用很高的效率來反向代理其他 Web Server，讓他們的效率更高。簡單來說他是個超級棒的仲介。
- 至於他能夠當上這麼厲害的仲介歸因於:
  1. 分流請求: 舉例來說就是可以把大量使用者要一次擠進 Express 上時可以幫忙分配請求，以避免過載。
  2. 負載均衡: 如果有多個 Server 在同一個 Express 上運行的話，Nginx 可以均勻地分配請求，讓系統更穩定。
  3. SSL 處理: 簡單來說就是可以幫忙處理 HTTPS 的加密連線，降低 Express 的負擔。
- 最後他的優點: 很快、很省資源、又穩定。所以他才這麼紅。

## 4. pm2 套件是什麼？有什麼用處？

PM2 是一個專門用來管理 Node.js 應用程式的**程序管理器**。
**他能夠解決的問題:**

1. node 服務突然 crash 掉的話，它會自動幫我們重啟 node 服務。
2. 可以利用 CPU 多核，開啟多程序達到負載平衡的效果，更高效地使用伺服器資源，提高應用的性能。
3. 日誌管理，可以隨時查看應用運行時的輸出，可以幫助我們排查問題。
4. 總結來說，他就像是一個守護者，可以幫助 node 不會崩潰。

## 5. 步驟 9 中提到的 proxy 是什麼意思？為什麼要透過 Nginx 來 proxy 到 Express 開發的 Web Server?

proxy，是指使用 Nginx 作為「代理」來將用戶的請求轉發到後端的 Express 伺服器。這裡的 proxy 就是 反向代理（Reverse Proxy），它的作用是 Nginx 充當一個中間人，幫助處理所有來自外部網絡的請求，然後將這些請求轉交給 Express 應用程式來處理，最後再將結果回傳給用戶。

至於為何要特別使用 Nginx 來 proxy 到 Express 開發的 Web Server，主要就跟第三點所提到的一樣，他能夠很高效率的處理靜態資源，也可以很高效率的分配動態資源。並且他的負載量小，所以是一個能夠**以很簡單的方式提高 Web Server 效率的一個工具**!

## 6. 在 readme 中提供步驟 9 的 Nginx 設定檔

輸入: `sudo nano /etc/nginx/sites-available/default`

```
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                try_files $uri $uri/ =404;
                proxy_pass http://localhost:3000;
                proxy_http_version 1.1;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection 'upgrade';
                proxy_set_header Host $host;
                proxy_cache_bypass $http_upgrade;

        }
    }
```

主要是修改 location，修改完後儲存並退出編輯器（Ctrl + O，然後按 Enter，最後 Ctrl + X）

```
location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
}
```

## 7. Security Group 是什麼？用途為何？有什麼設定原則嗎？

Security Group（安全群組） 是 AWS EC2 服務中的一個 虛擬防火牆，它用來控制進出 EC2 執行個體的網路流量。
它決定了哪些 IP 地址或網路範圍可以連接到 instance，還有哪些流量允許流出 instance。

**主要用途:**

1. **控制入站流量（Inbound Traffic）：**
   Security Group 設置規則來允許哪些外部 IP 或端口可以進入你的 EC2 instance。比如，你可以允許只有你的本地電腦 IP 可以通過 SSH 連接到你的伺服器。
   ex. 像我為了要讓 http 能夠用我的 public IP: 54.248.207.103 連線，所以我就需要多設置一個 rule 讓他能夠被允許。

2. **控制出站流量（Outbound Traffic）：**
   它也控制哪些流量可以從你的 EC2 instance 發送到外部網絡。例如，你可以設置規則允許你的伺服器訪問網路上的特定資源。

**設置原則:**

1. 最小特權原則：
   只允許最小範圍的流量進入和流出。只開放你所需要的端口，並且限制允許存取的 IP 地址範圍。

2. 僅允許需要的端口：
   例如，如果你的應用只需要 HTTP（80） 和 SSH（22），那麼只應該開啟這兩個端口。不要開放不需要的端口，**以免增加潛在的安全風險**。

3. 限制 IP 範圍：
   對於 SSH 或資料庫連接等敏感服務，應限制允許連接的 IP 範圍。最好只允許來自特定 IP 地址或子網的連接，避免開放給所有人（0.0.0.0/0）。

4. 分離不同功能的 Security Group：
   將不同類型的流量分開處理。例如，你可以為 Web 伺服器設置一個允許 HTTP/HTTPS 流量的 Security Group，並為資料庫設置一個僅允許應用伺服器存取的 Security Group。

5. 定期檢查規則：
   Security Group 的規則應該定期審核，確保沒有開放不必要的端口或 IP。這樣可以降低被攻擊的風險。

## 8. 什麼是 sudo? 為什麼有的時候需要加上 sudo，有時候不用？

- 在 Linux 作業系統中最高權限的管理者帳號為 `root`，也被稱作 superuser。管理者只要取得這個帳號就可以對系統進行各種變更，例如格式化與掛載硬碟、新增或刪除使用者帳號、更改各種系統服務、更新系統等。
- 但是就是因為權限太大了，所以操作上就會相對比較危險!所以通常為了避免不小心把系統搞砸，或是降低出錯的機率，在維護 Linux 系統時標準的作法是使用一般的帳號登入，遇到需要 root 權限時，再使用 su 或 sudo 取得較高的權限進行系統變更。
- 而 su 跟 sudo 的差異如下(參考 ChatGPT4o):

| 功能       | `su`                             | `sudo`                             |
| ---------- | -------------------------------- | ---------------------------------- |
| 用途       | 切換到 `root` 或其他使用者       | 執行單個超級用戶命令               |
| 密碼要求   | 需要 `root` 密碼                 | 需要當前使用者密碼                 |
| 權限持續性 | 切換後保持超級用戶模式直到退出   | 只提升權限於單個命令               |
| 安全性     | 風險較高，持續以超級用戶模式運行 | 安全性較高，僅限單次命令的權限提升 |
| 權限管理   | 無法細粒度控制權限               | 可以通過配置文件細粒度管理權限     |

簡單來說，sudo 比較常用，是一個安全性很高且僅限單次命令權限的方法!在**安裝、移除或更新系統級別的軟體; 修改系統配置檔案; 管理服務**等等涉及到系統關鍵資源的操作就需要 sudo 來多一層安全性的保護!

---

## 9. Nginx 的 Log 檔案在哪裡？你怎麼找到的？怎麼看 Nginx 的 Log？

- Nginx 的 Log 檔案通常位於 /var/log/nginx/ 目錄下。
- **常見的 Nginx 日誌檔案：**
  訪問日誌 (Access Log)：
  檔案路徑：/var/log/nginx/access.log
  這個日誌記錄了所有的 HTTP 請求，包括每個請求的時間、IP 地址、請求的 URL 路徑、響應狀態碼等資訊。
  可以用來分析網站訪問情況，檢查客戶端的請求，或調試流量問題。
- **錯誤日誌 (Error Log)：**
  檔案路徑：/var/log/nginx/error.log
  這個日誌記錄了 Nginx 在運行過程中遇到的錯誤或問題，例如配置錯誤、伺服器資源不足、後端伺服器無法連接等。
  可以用來調試伺服器配置問題或追蹤 Nginx 的運行狀態。

我是問 GPT 他告訴我怎麼找的，GPT 說 Nginx 的日誌檔案位置通常在安裝 Nginx 時的默認配置中已經設置好，默認存放在 /var/log/nginx/ 目錄下。

以下指令可以查看訪問日誌以及錯誤日誌

```
訪問日誌:
access_log /var/log/nginx/access.log;

錯誤日誌:
error_log /var/log/nginx/error.log;
```

如果要查看完整的訪問日誌以及錯誤日誌的話，可以改用以下指令:

```
訪問日誌:
cat /var/log/nginx/access.log

錯誤日誌:
cat /var/log/nginx/error.log
```

## 參考資料

- https://medium.com/starbugs/web-server-nginx-2-bc41c6268646

- https://medium.com/learn-or-die/%E5%A5%BD-pm2-%E4%B8%8D%E7%94%A8%E5%97%8E-fc7434cc8821

- https://medium.com/linux-on-raspberry-pi4/linux-%E7%9A%84-su-%E8%88%87-sudo-%E6%8C%87%E4%BB%A4%E6%95%99%E5%AD%B8%E8%88%87%E7%AF%84%E4%BE%8B-%E8%BD%89%E9%8C%84-a47251c5296

---

# 補充問題(操作過程中，先查詢的資料。)

### 1. 啥是 AWS EC2

AWS EC2（Amazon Elastic Compute Cloud）是 Amazon Web Services (AWS) 提供的一項核心服務，專為提供可擴展的計算能力而設計。它允許使用者在 AWS 雲端上啟動虛擬伺服器，這些虛擬伺服器稱為 "實例" (Instances)

---

### 2. 為何進入 ubuntu 後需要立刻輸入以下指令

```
sudo apt update -y
sudo apt upgrade -y
```

- 建構 AWS EC2 後第一步就是輸入這兩個指令
  當您進入 Ubuntu 系統後，立刻執行以下指令是因為這些操作可以確保系統的軟體包和依賴關係是最新的，並且能夠提高安全性和穩定性。讓我們詳細解析每個指令的功能和為何需要立即執行它們：

##### 1. **`sudo apt update -y`**

- **功能**：`apt update` 命令會更新系統的軟體包索引 (Package Index)。

  - **軟體包索引** 是系統用來管理安裝和更新軟體的資料庫，它儲存了所有可用軟體包的最新版本資訊。
  - 當您運行這個命令時，Ubuntu 會連接到已配置的軟體源（repository），檢查並更新本地的軟體包索引數據。這樣，當您之後想要安裝或更新軟體時，系統就會使用最新版本的軟體包。
  - 加上 `-y` 參數，系統會自動回答 "yes" 並進行更新操作，而不需要手動確認。

- **為何需要這麼做？**
  - 當您剛啟動 Ubuntu 系統時，系統中的軟體包索引可能是過時的，這樣會導致安裝軟體時獲得過舊版本的軟體。因此，進行 `apt update` 可以確保系統獲取到最新的軟體版本和安全更新。

##### 2. **`sudo apt upgrade -y`**

- **功能**：`apt upgrade` 命令會根據前面 `apt update` 更新的索引，實際執行軟體包的升級。

  - 這個命令會檢查目前系統中的已安裝軟體包，並將其更新為最新的可用版本。如果有新的版本可以用於已安裝的軟體，它會自動下載並升級這些軟體包。
  - 加上 `-y` 參數，同樣會自動同意所有的升級操作，而不需要手動確認。

- **為何需要這麼做？**
  - 運行這個命令的原因是為了確保您的系統上所有已安裝的軟體和安全補丁都是最新的。升級過程中可能會修補安全漏洞、提高性能或修復軟體中的已知問題。
  - **安全性** 是這一命令的主要考量之一。許多系統上的應用程式和核心軟體包可能會隨著時間發現漏洞和安全問題，這些問題會通過定期的更新和升級來修補。

### 總結：

在您首次進入 Ubuntu 系統時執行以下兩條指令是非常重要的：

```
sudo apt update -y
sudo apt upgrade -y
```

1. **`sudo apt update -y`** 會確保您的系統知道軟體源中所有最新的軟體包資訊。
2. **`sudo apt upgrade -y`** 會將所有已安裝的軟體包升級到最新版本，從而提高安全性和穩定性。

這兩步驟的操作可以幫助您避免潛在的安全風險，並確保系統處於最佳狀態。在使用 Ubuntu 系統時，養成定期執行這些指令的習慣是非常有益的。

---

### 3. Nginx 是啥?

- 安裝 Nginx: `sudo apt install nginx -y`
- 安裝完成後，啟動 Nginx: `sudo systemctl start nginx`
- 設置 Nginx 開機自動啟動: `sudo systemctl enable nginx`

Nginx（讀作 "Engine-X"）是一款開源、高效能的網頁伺服器和反向代理伺服器，同時還可以用來作為負載平衡器和 HTTP 緩存伺服器。它由於其輕量且高效能的設計，成為了許多企業和網站的首選網頁伺服器之一。
ex. Netflix、Airbnb、GitHub、Instagram 等等

---

### 4. 我們現在的操作簡單來說就是在 AWS 建構一個虛擬的伺服器主機的意思嗎?然後我們選用的作業系統是 Linux Ubuntu 24.04 是嗎?

沒錯!簡單來說就是利用 AWS 的 EC2 建構一個虛擬伺服器。然後設定主要作業系統為 Linux Ubuntu 24.04。

### 5. -y 是啥? 像是: sudo apt install nginx -y

-y 參數在許多 Linux 命令中（例如 apt 命令）用來表示**自動回答所有提示中的 "yes"**。這樣可以使命令在執行過程中自動同意安裝、升級或移除的提示，而不需要人工干預。

### 6. sudo apt 是啥?

`sudo apt` 是在基於 Debian 的 Linux 發行版（例如 Ubuntu）上用來**管理軟體包**的命令工具。這個工具能幫助您安裝、更新、升級、移除軟體包，以及管理系統中的軟體。

#### 具體來看：

##### 1. **`sudo`**:

- `sudo` 代表 **"superuser do"**，是用來以**超級使用者（root）權限**執行命令的工具。在 Linux 系統中，許多重要的操作（例如安裝軟體、修改系統配置）需要超級使用者的權限才能執行。
- 當您在命令前面加上 `sudo`，系統會要求您輸入使用者密碼來確認您有權限執行該命令。

##### 2. **`apt`**:

- `apt` 是 **Advanced Package Tool** 的簡稱，是一個用於**軟體包管理**的命令行工具。它能夠簡化安裝、升級、移除和管理軟體包的過程。
- 在 Ubuntu 和其他基於 Debian 的發行版中，`apt` 通常與系統的軟體源（repositories）連接，這些軟體源包含了數以千計的軟體包。

#### 常用的 `apt` 命令：

1. **更新軟體包列表**：

   ```bash
   sudo apt update
   ```

   這會更新系統的軟體包索引列表，讓您的系統知道哪些軟體有新版本可用，但這個命令本身並不會進行升級或改變任何軟體包。

2. **升級已安裝的軟體包**：

   ```bash
   sudo apt upgrade
   ```

   這會將系統中所有已安裝的軟體包更新到最新版本。

3. **安裝新軟體包**：

   ```bash
   sudo apt install <軟體名稱>
   ```

   例如，您可以使用這條命令來安裝 Nginx：

   ```bash
   sudo apt install nginx
   ```

4. **移除已安裝的軟體包**：

   ```bash
   sudo apt remove <軟體名稱>
   ```

   例如，移除 Nginx：

   ```bash
   sudo apt remove nginx
   ```

5. **清理不需要的軟體包**：
   ```bash
   sudo apt autoremove
   ```
   這會自動移除系統中那些不再需要的軟體包，通常是升級過程中被替換掉的舊版本。

#### 總結：

- `sudo` 提供了**超級使用者權限**，允許您執行需要更高級別權限的操作。
- `apt` 是一個**軟體包管理工具**，允許您安裝、更新、升級、移除軟體，並管理系統的軟體包。

`sudo apt` 組合起來，表示您在以超級使用者身份執行軟體管理的操作。這是系統管理和軟體維護的核心工具。
